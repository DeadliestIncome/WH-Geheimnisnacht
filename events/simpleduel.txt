###########################################
#                                         #
# Warhammer simple vanilla based duels    #
#                                         #
# ID simple_duel.1-simpleduel.999                
#                                         #
###########################################

# Written by Piotr St¿pnicki
#
#
# Modifiers
# declined_prestige_duel_timer
# recent_duel_timer
#
# Enemy - is whomever is not you 
#
namespace = simpleduel

### Duels

# TEST 
character_event = {
	id = simpleduel.0
	desc = "DEBUG START DUEL"
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		create_character = {
			random_traits = no
			name = "Duel Tester"
			dynasty = random
			religion = ROOT
			female = no
			age = 40
			attributes = {
			    martial = 6
			    diplomacy = 8
			    stewardship = 9
			    intrigue = 12
			    learning = 12
			}
			health = 6
			fertility = 0.8
		}
		new_character = {
			add_trait = creature_human
			character_event = {
				id = simpleduel.999
			}
		}
	}
}
character_event = {
	id = simpleduel.999
	is_triggered_only = yes
	hide_window = yes

	# FROM = human player
	# ROOT = NPC
	immediate = { character_event = { id = simpleduel.998 }}
}
character_event = {
	id = simpleduel.998
	is_triggered_only = yes
	hide_window = yes
	
	# FROMFROM = human player
	# FROM = NPC
	# ROOT = NPC
	immediate = { FROMFROM = { character_event = { id = simpleduel.1 }}}
}
# Get challenged
character_event = {
	id = simpleduel.1
	desc = EVTDESC_SIMPLEDUEL_1
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					NOT = { has_character_modifier = declined_prestige_duel_timer }
					NOT = { 
						AND = {
							is_female = no
							event_target:challenger = { is_female = yes }
							top_liege = { is_nomadic = no }
						}
					}
				}
			}
			add_character_modifier = {
				modifier = declined_prestige_duel_timer
				duration = 1095
				hidden = yes
			}
			set_character_flag = punish_declining
		}
		if = {
			limit = { NOT = { has_character_modifier = recent_duel_timer } }
			add_character_modifier = {
				modifier = recent_duel_timer
				hidden = yes
				duration = 365
			}
		}
		FROMFROM = {
			if = {
				limit = { NOT = { has_character_modifier = recent_duel_timer } }
				add_character_modifier = {
					modifier = recent_duel_timer
					hidden = yes
					duration = 365
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_1
		ai_chance = {
			factor = 20
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 3
				OR = {
					trait = creature_orc
					trait = creature_dwarf
				}
			}
			modifier = {
				factor = 0.05
				trait = craven
			}
			#modifier = {
			#	factor = 0.3
			#	religion = jain
			#}
			modifier = {
				is_female = no
				FROM = { is_female = yes }
				top_liege = {
					is_nomadic = no
				}
				factor = 0.025
			}
		}
		if = {
			limit = { trait = craven }
			random = {
				chance = 20
				remove_trait = craven
			}
		}
		#if = {
		#	limit = { religion = jain }
		#	piety = -20
		#	custom_tooltip = { text = jain_ahimsa_tooltip }
		#}
		if = {
			limit = { 
				FROMFROM = { 
					has_opinion_modifier = { who = ROOT modifier = grievously_offended }
				}
			}
			FROMFROM = {
				remove_opinion = { who = ROOT modifier = grievously_offended }
			}
		}
		save_event_target_as = opponent
		FROMFROM = {
			save_event_target_as = challenger
			hidden_tooltip = {
				character_event = { id = simpleduel.2 days = 1 }
			}
		}
		clr_character_flag = punish_declining
	}
	# Decline duel
	option = {
		name = EVTOPTB_SIMPLEDUEL_1
		ai_chance = {
			factor = 1
		}
		if = {
			limit = { has_character_flag = punish_declining }
			if = {
				limit = { 
					NOR = {
						trait = craven
						trait = brave
						trait = berserker 
					}
				}
				random = {
					chance = 30
					add_trait = craven
					hidden_tooltip = {
						character_event = {
							id = 38257 #Notify Craven
						}
					}
				}
			}
			if = {
				limit = {
					trait = brave
				}
				remove_trait = brave
			}
			prestige = -50
			add_character_modifier = {
				modifier = declined_prestige_duel_timer
				hidden = yes
				duration = 1095
			}
		}
		hidden_tooltip = {
			remove_character_modifier = recent_duel_timer
		}
		FROMFROM = {
			hidden_tooltip = {
				remove_character_modifier = recent_duel_timer
				opinion = {
					modifier = opinion_fled_duel
					who = ROOT
					years = 100
				}
				character_event = { id = simpleduel.3 days = 3 }
			}
		}
		clr_character_flag = punish_declining
	}
}

# Start the duel
character_event = {
	id = simpleduel.2
	is_triggered_only = yes
	desc = EVTDESC_SIMPLEDUEL_2
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_2
		character_event = { id = simpleduel.4 }
	}
}

# Duel rejected
character_event = {
	id = simpleduel.3
	is_triggered_only = yes
	desc = EVTDESC_SIMPLEDUEL_3
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_3
	}
}

# Pop-in without dialogue to accept 
# (event_target:opponent and event_target:challenger must be set)
character_event = {
	id = simpleduel.4
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		if = {
			limit = { NOT = { has_character_modifier = recent_duel_timer } }
			add_character_modifier = {
				modifier = recent_duel_timer
				hidden = yes
				duration = 365
			}
		}
		event_target:opponent = {
			if = {
				limit = { NOT = { has_character_modifier = recent_duel_timer } }
				add_character_modifier = {
					modifier = recent_duel_timer
					hidden = yes
					duration = 365
				}
			}
		}
		opinion = {
			modifier = opinion_fought_duel
			who = event_target:opponent
			years = 150
		}
		if = {
			limit = {
				has_character_modifier = recent_duel_victory
			}
			remove_character_modifier = recent_duel_victory
		}
		event_target:opponent = {			
			opinion = {
				modifier = opinion_fought_duel
				who = ROOT
				years = 150
			}
			hidden_tooltip = {
				character_event = { id = simpleduel.5 }
			}
		}
	}
}

# Opponent bounce for scopes (hidden)
character_event = {
	id = simpleduel.5
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		if = {
			limit = {
				has_character_modifier = recent_duel_victory
			}
			remove_character_modifier = recent_duel_victory
		}
		FROM = {
			character_event = { id = simpleduel.6 }
		}
	}
}


# Duel (hidden)
character_event = {
	id = simpleduel.6
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		log = "simpleduel.6: [Root.GetBestName] challenged [From.GetBestName] on a duel"
		random_list = {
			1 = { # Draw: double death
				modifier = {
					OR = {
						combat_rating_diff = { who = FROM value = 4 }
						FROM = { combat_rating_diff = { who = ROOT value = 4 } }
					}
					factor = 0.2
				}
				modifier = {
					trait = wroth
					FROM = {
						trait = wroth
					}
					factor = 2
				}
				long_character_event = { id = simpleduel.10 }
				FROM = { long_character_event = { id = simpleduel.10 } }
			}
			1 = { # challenger overwhelming victory
				modifier = {
					NOT = { combat_rating_diff = { who = FROM value = 1 } }
					factor = 0
				}
				add_character_modifier = {
					modifier = recent_duel_victory
					months = 12
				}
				set_character_flag = overwhelming_victory
				long_character_event = { id = simpleduel.12 }
			}
			1 = { # opponent overwhelming victory
				modifier = {
					NOT = { FROM = { combat_rating_diff = { who = ROOT value = 1 } } }
					factor = 0
				}
				FROM = {
					add_character_modifier = {
						modifier = recent_duel_victory
						months = 12
					}
					set_character_flag = overwhelming_victory
					long_character_event = { id = simpleduel.12 } 
				}
			}
			200 = { # challenger win
				### modifiers
				#modifier = {
				#	factor = 0
				#	always = yes ######### DEBUGGING
				#}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 1 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 2 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 3 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 4 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 5 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 6 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 7 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 8 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 9 }
					}
					factor = 0.7
				}
				modifier = {
					FROM = {
						combat_rating_diff = { who = ROOT value = 10 }
					}
					factor = 0.7
				}
				### effects
				random_list = {
					70 = {						
						add_character_modifier = {
							modifier = recent_duel_victory
							months = 12
						}
						long_character_event = { id = simpleduel.7 }
					}
					30 = {
						modifier = {
							FROM = { is_maimed_trigger = yes }
							factor = 0
						}
						add_character_modifier = {
							modifier = recent_duel_victory
							months = 12
						}
						set_character_flag = duel_maim
						long_character_event = { id = simpleduel.7 }
					}
				}
			}
			200 = { # opponent win
				### modifiers
				#modifier = {
				#	factor = 0
				#	always = yes ######### DEBUGGING
				#}
				modifier = {
					combat_rating_diff = { who = FROM value = 1 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 2 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 3 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 4 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 5 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 6 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 7 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 8 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 9 }
					factor = 0.7
				}
				modifier = {
					combat_rating_diff = { who = FROM value = 10 }
					factor = 0.7
				}
				### effects
				random_list = {
					70 = {
						FROM = {
							add_character_modifier = {
								modifier = recent_duel_victory
								months = 12
							}
							long_character_event = { id = simpleduel.7  } 
						}
					}
					30 = {
						modifier = {
							is_maimed_trigger = yes
							factor = 0
						}
						FROM = {
							add_character_modifier = {
								modifier = recent_duel_victory
								months = 12
							}
							set_character_flag = duel_maim
							long_character_event = { id = simpleduel.7  } 
						}
					}
				}
			}
		}
	}
}

# Winner event report
long_character_event = {
	id = simpleduel.7
	is_triggered_only = yes
	picture = GFX_evt_melee
	border = GFX_event_long_frame_war
	title = duel_title
	# Ice mage vs human
	desc = {
		trigger = {
			trait = lore_ice
			event_target:enemy = { trait = creature_human }
		}
		text = EVTDESC_SIMPLEDUEL_7 
		picture = GFX_evt_mage_lore_ice
	}
	# Grail vs Chaos
	desc = {
		trigger = {
			duel_grail_chaos_trigger = yes
			duel_spellcasters_trigger = no 
		}
		text = EVTDESC_SIMPLEDUEL_7 # Maiming opponent
		picture = GFX_evt_grail_vs_chaos
	}
	# Elf - dark elf magic duel
	desc = {
		trigger = { 
			duel_dark_high_elf_trigger = yes 
			duel_spellcasters_trigger = yes 
		}
		text = EVTDESC_SIMPLEDUEL_7 
		picture = GFX_evt_elf_magic_duel
	}
	# Dark elf vs chaos
	desc = {
		trigger = { duel_dark_elf_chaos_trigger = yes }
		text = EVTDESC_SIMPLEDUEL_7 # Maiming opponent
		picture = GFX_evt_dark_elf_vs_chaos
	}
	# Human dark elf vs high elf melee
	desc = {
		trigger = { 
			duel_dark_high_elf_trigger = yes 
			duel_spellcasters_trigger = no
		}
		text = EVTDESC_SIMPLEDUEL_7 # Maiming opponent
		picture = GFX_evt_dark_elf_vs_high_elf
	}
	# Human melee against lizardman
	desc = {
		trigger = { duel_human_lizardman_trigger = yes }
		text = EVTDESC_SIMPLEDUEL_7 
		picture = GFX_evt_estalian_vs_saurus
	}
	# General human against chaos 
	desc = {
		trigger = { duel_human_chaos_trigger = yes }
		text = EVTDESC_SIMPLEDUEL_7 
		picture = GFX_evt_duel_against_chaos
	}

	# To simplify localisaiton set enemy vs root
	immediate = {
		if = {
			limit = {
				event_target:challenger = { character = ROOT }
			}
			event_target:opponent = { save_event_target_as = enemy }
		}
		else = {
			event_target:challenger = { save_event_target_as = enemy }
		}
	}
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_7
		trigger = {
			has_character_flag = duel_maim
		}
		ai_chance = {
			factor = 15
			modifier = {
				factor = 0.8
				in_command =  yes
			}
			modifier = {
				factor = 0.5
				in_battle =  yes
			}
		}
		prestige = 50
		if = {
			limit = { event_target:challenger = { character = ROOT } }
			tooltip = {
				event_target:opponent = {
					maim_hand_effect = yes
					if = {
						limit = { NOT = { is_rival = ROOT } }
						add_rival = ROOT
					}
				}	
			}
			hidden_tooltip = {
				event_target:opponent = {
					long_character_event = { id = simpleduel.8 }
				}
				if = {
					limit = { has_focus = focus_war }
					random = {
						chance = 50
						character_event = { id = simpleduel.11200 }
					}
				}
			}
		}		
		if = {
			limit = { NOT = { event_target:challenger = { character = ROOT } } }
			tooltip = {
				event_target:challenger = {
					maim_hand_effect = yes
					if = {
						limit = { NOT = { is_rival = ROOT } }
						add_rival = ROOT
					}
				}
			}
			hidden_tooltip = {
				event_target:challenger = {
					long_character_event = { id = simpleduel.8 }
				}
				if = {
					limit = { has_focus = focus_war }
					random = {
						chance = 50
						character_event = { id = simpleduel.11200 }
					}
				}
			}
		}
		hidden_tooltip = { character_event = { id = 720 } } # Bring it On achievement check event
	}
	
	option = {
		name = EVTOPTB_SIMPLEDUEL_7
		trigger = {
			NOT = {
				has_character_flag = duel_maim
			}
		}
		ai_chance = {
			factor = 15
			modifier = {
				factor = 0.8
				in_command =  yes
			}
			modifier = {
				factor = 0.5
				in_battle =  yes
			}
		}
		prestige = 50
		if = {
			limit = { event_target:challenger = { character = ROOT } }
			if = {
				limit = { event_target:opponent = { NOT = { is_maimed_trigger = yes } } }
				tooltip = {
					event_target:opponent = {
						add_trait = wounded
					}
				}
			}
			hidden_tooltip = {
				event_target:opponent = {
					long_character_event = { id = simpleduel.8 }
				}
				random = {
					chance = 25
					character_event = { id = simpleduel.11200 }
				}
			}
		}
		if = {
			limit = { NOT = { event_target:challenger = { character = ROOT } } }
			if = {
				limit = { event_target:challenger = { NOT = { is_maimed_trigger = yes } } }
				tooltip = {
					event_target:challenger = {
						add_trait = wounded
					}
				}
			}
			hidden_tooltip = {
				event_target:challenger = {
					long_character_event = { id = simpleduel.8 }
				}
				random = {
					chance = 25
					character_event = { id = simpleduel.11200 }
				}
			}
		}
		hidden_tooltip = { character_event = { id = 720 } } # Bring it On achievement check event
	}
	# Execute
	option = {
		name = EVTOPTC_SIMPLEDUEL_7
		ai_chance = {
			factor = 1
			modifier = {
				trait = kind
				factor = 0.1
			}
			modifier = {
				trait = impaler
				factor = 15
			}
			modifier = {
				trait = cruel
				factor = 5
			}
			modifier = {
				OR = {
					AND = {
						event_target:opponent = { character = ROOT }
						is_rival = event_target:challenger
					}
					AND = {
						event_target:challenger = { character = ROOT }
						is_rival = event_target:opponent
					}
				}
				factor = 10
			}
			modifier = {
				factor = 10
				OR = {
					religion_group = chaos_gods_group
					religion_group = greensking_gods_group
					religion_group = horned_rat_god_group
					religion_group = necromantic_group
					religion_group = nehekharan_gods_group
				}
			}
			modifier = {
				factor = 3
				OR = {
					religion = northern_gods
					religion = norscan_gods
					religion_group = cytharai_group
				}
			}
			modifier = {
				factor = 20
				OR = {
					religion_group = chaos_gods_group
					religion_group = greensking_gods_group
					religion_group = horned_rat_god_group
					religion_group = necromantic_group
				}
				event_target:enemy = {
					NOR = {
						religion_group = chaos_gods_group
						religion_group = horned_rat_god_group
						religion_group = greensking_gods_group
						religion_group = necromantic_group
					}
				}
			}
			modifier = {
				factor = 20
				NOR = {
					religion_group = chaos_gods_group
					religion_group = greensking_gods_group
					religion_group = horned_rat_god_group
					religion_group = necromantic_group
				}
				event_target:enemy = {
					OR = {
						religion_group = chaos_gods_group
						religion_group = horned_rat_god_group
						religion_group = greensking_gods_group
						religion_group = necromantic_group
					}
				}
			}
		}
		prestige = 50
		custom_tooltip = {
			text = EVTTOOLTIPWOL7
			hidden_tooltip = {
				generate_tooltip = no
				any_realm_character = {
					opinion = {
						modifier = opinion_ruthless
						who = ROOT
						months = 60
					}
				}
			}
		}
		if = {
			limit = {
				has_character_modifier = merciless
			}
			if = {
				limit = {
					has_nickname = no
				}
				give_nickname = nick_the_ruthless
			}
		}
		if = {
			limit = {
				NOR = { 
					has_character_modifier = merciless 
					religion_group = chaos_gods_group
					religion_group = greensking_gods_group
					religion_group = horned_rat_god_group
					religion_group = necromantic_group
					religion_group = cytharai_group
					in_command = yes
					in_battle = yes
				}
				event_target:enemy = {
					NOR = {
						has_character_modifier = merciless 
						religion_group = chaos_gods_group
						religion_group = greensking_gods_group
						religion_group = horned_rat_god_group
						religion_group = necromantic_group
						religion_group = cytharai_group
					}
				}
			}
			add_character_modifier = {
				modifier = merciless
				duration = -1
			}
		}
		if = {
			limit = { event_target:challenger = { character = ROOT } }
			event_target:opponent = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
			tooltip = {
				event_target:opponent = {
					death = {
						death_reason = death_duel
						killer = event_target:challenger
					}
				}
			}
			hidden_tooltip = {
				event_target:opponent = {
					long_character_event = { id = simpleduel.9 }
				}
				random = {
					chance = 25
					character_event = { id = simpleduel.11200 }
				}
			}
		}
		if = {
			limit = { NOT = { event_target:challenger = { character = ROOT } } }
			event_target:challenger = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
			tooltip = {
				event_target:challenger = {
					death = {
						death_reason = death_duel
						killer = event_target:opponent
					}
				}
			}
			hidden_tooltip = {
				event_target:challenger = {
					long_character_event = { id = simpleduel.9 }
				}
				random = {
					chance = 25
					character_event = { id = simpleduel.11200 }
				}
			}
		}
		hidden_tooltip = { character_event = { id = 720 } } # Bring it On achievement check event
	}
}

# Loser event
long_character_event = {
	id = simpleduel.8
	is_triggered_only = yes
	picture = GFX_evt_melee
	border = GFX_event_long_frame_war
	title = duel_title
	
	# FROM is winner
	desc = EVTDESC_SIMPLEDUEL_8
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_8

		prestige = -50
		if = {
			limit = {
				FROM = { has_character_flag  = duel_maim }
			}
			maim_hand_effect = yes
			if = {
				limit = { NOT = { is_rival = FROM } }
				add_rival = FROM
			}
		}
		if = {
			limit = {
				NOT = { FROM = { has_character_flag = duel_maim } }
				NOT = { is_maimed_trigger = yes }
			}
			add_trait = wounded
		}
		FROM = { clr_character_flag = duel_maim }
		hidden_tooltip = {
			random = {
				chance = 35
				character_event = { id = simpleduel.14 days = 3 }
			}
		}
	}
}

# Loser event executed
long_character_event = {
	id = simpleduel.9
	is_triggered_only = yes
	desc = EVTDESC_SIMPLEDUEL_9
	picture = GFX_evt_melee
	border = GFX_event_long_frame_war
	title = duel_title
	
	immediate = {
		if = {
			limit = { multiplayer = yes }
			death = {
				death_reason = death_duel
				killer = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTA_CM_6303
		hidden_tooltip = {
			FROM = { clr_character_flag = duel_maim }
		}
		save_event_target_as = kinslayer_target
		tooltip = { FROM = { add_kinslayer_trait_effect = yes } }
		if = {
			limit = { multiplayer = no }
			death = {
				death_reason = death_duel
				killer = FROM
			}
		}
	}
}

# Double death (common)
long_character_event = {
	id = simpleduel.10
	is_triggered_only = yes
	picture = GFX_evt_melee
	border = GFX_event_long_frame_war
	title = duel_title
	desc = EVTDESCA_SIMPLEDUEL_10 
	
	immediate = {
		if = {
			limit = {
				event_target:challenger = { character = ROOT }
			}
			event_target:opponent = { save_event_target_as = enemy }
		}
		else = {
			limit = {
				NOT = { event_target:challenger = { character = ROOT }}
			}
			event_target:challenger = { save_event_target_as = enemy }
		}

		if = {
			limit = { multiplayer = yes }
			if = {
				limit = { event_target:challenger = { character = ROOT } }
				event_target:opponent = { save_event_target_as = kinslayer_target }
				add_kinslayer_trait_effect = yes
				death = {
					death_reason = death_duel
					killer = event_target:opponent
				}
			}
			if = {
				limit = { NOT = { event_target:challenger = { character = ROOT } } }
				event_target:challenger = { save_event_target_as = kinslayer_target }
				add_kinslayer_trait_effect = yes
				death = {
					death_reason = death_duel
					killer = event_target:challenger
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_CM_6303
		if = {
			limit = { event_target:challenger = { character = ROOT } }
			event_target:opponent = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
			save_event_target_as = kinslayer_target
			event_target:opponent = { add_kinslayer_trait_effect = yes }
			if = {
				limit = { multiplayer = no }
				death = {
					death_reason = death_duel
					killer = event_target:opponent
				}
			}
			tooltip = {
				event_target:opponent = {
					death = {
						death_reason = death_duel
						killer = event_target:challenger
					}
				}
			}
		}
		if = {
			limit = { NOT = { event_target:challenger = { character = ROOT } } }
			event_target:challenger = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
			save_event_target_as = kinslayer_target
			event_target:challenger = { add_kinslayer_trait_effect = yes }
			if = {
				limit = { multiplayer = no }
				death = {
					death_reason = death_duel
					killer = event_target:challenger
				}
			}
			tooltip = {
				event_target:challenger = {
					death = {
						death_reason = death_duel
						killer = event_target:opponent
					}
				}
			}
		}
	}
}

# Winner decap
long_character_event = {
	id = simpleduel.12
	is_triggered_only = yes
	picture = GFX_evt_melee
	border = GFX_event_long_frame_war
	title = duel_title
	# Ice mage vs human
	desc = {
		trigger = { 
			z_dueling_caster = yes 
			trait = lore_ice
			event_target:enemy = { trait = creature_human }
		}
		text =  EVTDESC_SIMPLEDUEL_12
		picture = GFX_evt_mage_lore_ice
	}
	# Grail vs Chaos
	desc = {
		trigger = {
			duel_grail_chaos_trigger = yes
			duel_spellcasters_trigger = no 
		}
		text =  EVTDESC_SIMPLEDUEL_12
		picture = GFX_evt_grail_vs_chaos
	}
	# Elf - dark elf magic duel
	desc = {
		trigger = { 
			duel_dark_high_elf_trigger = yes 
			duel_spellcasters_trigger = yes 
		}
		text =  EVTDESC_SIMPLEDUEL_12
		picture = GFX_evt_elf_magic_duel
	}
	# Dark elf vs chaos
	desc = {
		trigger = { duel_dark_elf_chaos_trigger = yes }
		text =  EVTDESC_SIMPLEDUEL_12
		picture = GFX_evt_dark_elf_vs_chaos
	}
	# Human dark elf vs high elf melee
	desc = {
		trigger = { 
			duel_dark_high_elf_trigger = yes 
			duel_spellcasters_trigger = no
		}
		text =  EVTDESC_SIMPLEDUEL_12
		picture = GFX_evt_dark_elf_vs_high_elf
	}
	# Human melee against lizardman
	desc = {
		trigger = { duel_human_lizardman_trigger = yes }
		text =  EVTDESC_SIMPLEDUEL_12
		picture = GFX_evt_estalian_vs_saurus
	}
	# General human against chaos 
	desc = {
		trigger = { duel_human_chaos_trigger = yes }
		text =  EVTDESC_SIMPLEDUEL_12
		picture = GFX_evt_duel_against_chaos
	}

	immediate = {
		if = {
			limit = { event_target:challenger = { character = ROOT }}
			event_target:opponent = { save_event_target_as = enemy }
		}
		else = { event_target:challenger = { save_event_target_as = enemy }}
	}

	option = {
		trigger = { event_target:challenger = { character = ROOT } }
		name = EVTOPTA_SIMPLEDUEL_12
		prestige = 100
		if = {
			limit = {
				event_target:opponent = {
					has_nickname = no
				}
			}
			event_target:opponent = {
				give_nickname = nick_the_headless
			}
		}
		if = {
			limit = {
				has_nickname = no
			}
			give_nickname = nick_the_beheader
		}
		event_target:opponent = { save_event_target_as = kinslayer_target }
		add_kinslayer_trait_effect = yes
		tooltip = {
			event_target:opponent = {
				death = {
					death_reason = death_duel
					killer = ROOT
				}
			}
		}
		hidden_tooltip = {
			event_target:opponent = { long_character_event = { id = simpleduel.13 } }
		}
		hidden_tooltip = {
			random = {
				chance = 50
				character_event = { id = simpleduel.11200 }
			}
		}
		hidden_tooltip = { character_event = { id = 720 } } # Bring it On achievement check event
	}
	
	option = {
		trigger = { NOT = { event_target:challenger = { character = ROOT } } }
		name = EVTOPTA_SIMPLEDUEL_12
		prestige = 100
		if = {
			limit = {
				event_target:challenger = {
					has_nickname = no
				}
			}
			event_target:challenger = {
				give_nickname = nick_the_headless
			}
		}
		if = {
			limit = {
				has_nickname = no
			}
			give_nickname = nick_the_beheader
		}
		event_target:challenger = { save_event_target_as = kinslayer_target }
		add_kinslayer_trait_effect = yes
		tooltip = {
			event_target:challenger = {
				death = {
					death_reason = death_duel
					killer = ROOT
				}
			}
		}
		hidden_tooltip = {
			event_target:challenger = { long_character_event = { id = simpleduel.13 } }
		}
		hidden_tooltip = {
			random = {
				chance = 50
				character_event = { id = simpleduel.11200 }
			}
		}
		hidden_tooltip = { character_event = { id = 720 } } # Bring it On achievement check event
	}
	after = {
		clr_character_flag = overwhelming_victory
	}
}

# Loser decap
long_character_event = {
	id = simpleduel.13
	is_triggered_only = yes
	desc = EVTDESC_SIMPLEDUEL_13
	picture = GFX_evt_melee
	border = GFX_event_long_frame_war
	title = duel_title
	
	immediate = {
		if = {
			limit = { has_nickname = no }
			give_nickname = nick_the_headless
		}
		if = {
			limit = { multiplayer = yes }
			death = {
				death_reason = death_duel
				killer = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_13
		if = {
			limit = { has_nickname = no }
			tooltip = {
				give_nickname = nick_the_headless
			}
		}
		if = {
			limit = { multiplayer = no }
			death = {
				death_reason = death_duel
				killer = FROM
			}
		}
	}
	after = {
		clr_character_flag = overwhelming_victory
	}
}

# Gain rival
character_event = {
	id = simpleduel.14
	is_triggered_only = yes
	desc = EVTDESC_SIMPLEDUEL_14
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	
	trigger = {
		NOT = {
			is_rival = FROMFROM
		}
	}
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_14
		add_rival = FROMFROM
		hidden_tooltip = {
			FROMFROM = {
				character_event = { id = simpleduel.15 }
			}
		}
	}
	
	option = {
		name = EVTOPTB_SIMPLEDUEL_14
		ai_chance = {
			factor = 0
		}
	}
}

# Gain rival notification
character_event = {
	id = simpleduel.15
	is_triggered_only = yes
	desc = EVTDESC_SIMPLEDUEL_15
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_war
	
	option = {
		name = EVTOPTA_SIMPLEDUEL_15
		trigger = {
			NOT = { num_of_rivals = 3 }
		}
		add_rival = FROM
	}
	
	option = {
		name = EVTOPTB_SIMPLEDUEL_15
		trigger = {
			num_of_rivals = 3
		}
		add_rival = FROM
	}
}

############### Minor events
